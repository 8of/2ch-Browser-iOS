# 2ch makaba API

Большинство работы с makaba API осуществляется через JSON за некоторым исключением, всё через SSL-домен.


## Список досок

http://2ch.hk/makaba/mobile.fcgi?task=get_boards


## Получение списка тредов для доски

https://2ch.hk/BOARD/PAGE.json

BOARD - код доски (b, soc и т.д.)
PAGE - номер страницы

Максимальное количество страниц для каждой доски разное, этот парамтер передаётся в ответе на запрос списка досок вместе с названием и кратким кодом.
Если страница - начальная, то в PAGE стоит подставить ключевое слово **index**.


## Получение списка сообщений для треда

https://2ch.hk/BOARD/res/THREAD_NUM.json

BOARD - код доски (b, soc и т.д.)
THREAD_NUM - номер сообщения ОП-поста треда (можно получить в списке тредов для доски).


## Отправка сообщения в тред / создание треда

https://2ch.hk/makaba/posting.fcgi

Параметры для передачи:

+ json = 1
+ task = post
+ board = *код доски*
+ thread = *номер треда* - для создания нового треда необходимо проставить 07
+ email = *значение поля e-mail*
+ name = *имя*
+ subject = *тема сообщения*
+ comment = *комментарий*, максимальное количество символов - 15000
+ image = *изображение для отправки*
+ captcha-key = *ключ капчи для проверки* - можно получить через отдельный метод. Для Яндекс-капчи он описан ниже.
+ captcha_value = *разгаданные символы капчи* - для Яндекс-капчи - цифры
+ usercode = *код для определения пасскода* - можно получить через отдельный метод

Параметры **usercode** и **captcha-key + captcha_value** являются взаимоисключающими.

При использовании их одновременно положительный ответ сервера не гарантирован.

Если используется что-то одно, то второе обязателньо должно **отсутствовать** в запросе.


## Получение Яндекс-капчи

Получение капчи можно разделить на несколько этапов:

+ получение кода с сервера 2ch
+ переход по ссылке и получение изображения Яндекс-капчи